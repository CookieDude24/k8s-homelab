apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
    name: authentik
    namespace: kube-system
spec:
    forwardAuth:
        address: "https://ak-outpost-k3s-proxy-outpost.kube-system.svc.cluster.local:9000/outpost.goauthentik.io/auth/traefik"
        trustForwardHeader: true
        authResponseHeaders:
            - X-authentik-username
            - X-authentik-groups
            - X-authentik-email
            - X-authentik-name
            - X-authentik-uid
            - X-authentik-jwt
            - X-authentik-meta-jwks
            - X-authentik-meta-outpost
            - X-authentik-meta-provider
            - X-authentik-meta-app
            - X-authentik-meta-version
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
    name: authentik-ingress
    namespace: kube-system
spec:
    entryPoints:
        - websecure
        - web
    routes:
        - kind: Rule
          match: Host(`auth.007337.xyz`)
          services:
              - name: ak-outpost-k3s-proxy-outpost
                port: 9000